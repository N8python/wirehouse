Original prompt: Make a traditional Wolfenstein-like maze in ThreeJS and procedurally generate a maze. Use HTML + JS. Make sure to research modern threejs practices. YOu should be able to nagivate around the maze in first person.

## Progress
- Scaffolded `index.html` with an import map for modern Three.js ESM (`three` + `three/addons`), a start overlay, and minimal HUD elements.
- Implemented `main.js` with:
  - Procedural maze generation via recursive backtracking.
  - First-person camera movement with collision checks against maze walls.
  - Pointer lock controls, fullscreen toggle (`F`), and regeneration (`N`).
  - Instanced wall rendering for low draw calls.
  - `window.render_game_to_text()` and `window.advanceTime(ms)` hooks for automated testing.
- Added automation-friendly gameplay activation for webdriver/headless runs while preserving pointer lock for normal browser sessions.
- Updated spawn orientation to face the first valid corridor step, improving immediate forward movement and validation.
- Installed local `playwright` dev dependency to run the skill’s test loop in this workspace.
- Verified with the Playwright client:
  - `output/web-game/shot-0.png`, `shot-1.png`, `shot-2.png` show in-maze first-person gameplay.
  - `output/web-game/state-*.json` confirms movement across cells and active play mode.
  - No `errors-*.json` emitted in final run.
- Verified responsive rendering:
  - Desktop: `output/responsive/desktop-menu.png`, `output/responsive/desktop-gameplay.png`
  - Mobile: `output/responsive/mobile-menu.png`, `output/responsive/mobile-gameplay.png`
- Adjusted floor texture tiling so UV repeats map 1:1 with maze cells and added a clearer single-cell floor tile pattern for grid alignment.
- Verified updated alignment in `output/floor-aligned-check.png`.
- Inset wall geometry footprint (`WALL_FOOTPRINT = CELL_SIZE - WALL_CELL_INSET`) so wall meshes stay inside their assigned cells.
- Verified updated wall bounds in `output/wall-cell-check.png`.
- Replaced uniform wall inset with edge-aware inset: only edges facing open cells are inset, while wall-to-wall shared edges remain flush to remove visible seams/holes.
- Verified seam fix in `output/wall-seam-fix-check.png`.
- Added `V` key view toggle between first-person and top-down cameras while preserving player state/position.
- Updated overlay controls text to include `V` for view switching.
- Verified view switching with `output/topdown-view-check.png`, `output/firstperson-view-check.png`, and no runtime errors in `output/view-toggle-errors.json`.
- Fixed top-down floor visibility by rendering top-down without fog and centering/fitting the top-down camera over the full maze.
- Verified visibility fix in `output/topdown-floor-visible-check.png` and ensured first-person remained correct in `output/firstperson-after-topdown-check.png`.
- Added externally sourced spooky PBR textures (wall + floor) from Poly Haven (CC0) under `assets/textures/`.
- Replaced procedural canvas materials with texture-loaded `MeshStandardMaterial` maps:
  - Floor: color + normal + roughness maps with cell-aligned tiling.
  - Walls: color + normal + roughness maps.
- Added `assets/textures/CREDITS.md` with license and source attribution links.
- Verified renders:
  - First-person: `output/spooky-firstperson.png`
  - Top-down: `output/spooky-topdown.png`
  - Runtime errors: none in `output/spooky-errors.json`
- Replaced wall instancing-over-boxes with voxel face meshing: only faces adjacent to air are emitted as geometry (`buildWallSurfaceGeometry`), preventing wall cube overlap/poke-through at corners.
- Verified corner/intersection visuals in:
  - `output/voxel-wall-corner-check-1.png`
  - `output/voxel-wall-corner-check-2.png`
  - `output/voxel-wall-topdown-check.png`
  - Runtime errors: none in `output/voxel-wall-errors.json`
- Restyled scene toward abandoned industrial facility:
  - Walls -> `factory_wall` texture set.
  - Floor -> `metal_plate_02` texture set.
  - Roof -> `rusty_metal_05` texture set.
- Added enclosed roof mesh with PBR textures; roof is hidden only in top-down mode to keep map readability.
- Added player flashlight (`SpotLight`) attached to camera with `L` toggle and state flag in `render_game_to_text`.
- Tuned lighting to darker low-ambient atmosphere plus stronger flashlight beam for gameplay readability.
- Removed all directional scene lighting (to match enclosed facility logic). Replaced top-down helper directional with temporary ambient fill light used only in top-down render.
- Updated controls text/status messaging to include flashlight key.
- Updated texture attribution file `assets/textures/CREDITS.md` for active wall/floor/roof sources (Poly Haven CC0).
- Verified outputs:
  - `output/facility-v2-flashlight-on.png`
- Added a flashlight model (`assets/models/old_flashlight.glb`) and mounted it on a camera-attached flashlight rig.
- Beam origin now emanates from the flashlight model head (spotlight + target attached to same rig).
- Added `flashlightModelLoaded` state flag in `render_game_to_text`.
- Updated credits file with model attribution (Sketchfab, Blender3D, CC BY 4.0).
- Verified model + beam behavior:
  - `output/flashlight-model-on.png`
  - `output/flashlight-model-off.png`
  - `output/flashlight-model-topdown.png`
  - Runtime errors: none in `output/flashlight-model-errors.json`
- Replaced heuristic flashlight orientation with deterministic orientation:
  - align model by dominant axis,
  - detect larger end-cap as flashlight head,
  - place spotlight origin/target from that computed tip.
- Verified updated orientation/beam behavior:
  - `output/flashlight-facing-check-on.png`
  - `output/flashlight-facing-check-off.png`
  - Runtime errors: none in `output/flashlight-facing-errors.json`
  - `output/facility-v2-flashlight-off.png`
  - `output/facility-v2-topdown.png`
  - Runtime errors: none in `output/facility-v2-errors.json`
- Added flashlight cookie/gobo projection map from OpenGameArt and assigned it to `SpotLight.map` for patterned beam projection.
- Added attribution for the new flashlight map to `assets/textures/CREDITS.md` (creator, page link, CC0 license URL, file used).
- Verified beam-map integration via Playwright loop:
  - `output/flashlight-pattern/shot-0.png`
  - `output/flashlight-pattern/shot-1.png`
  - `output/flashlight-pattern/shot-2.png`
  - `output/flashlight-pattern/state-0.json`
  - `output/flashlight-pattern/state-1.json`
  - `output/flashlight-pattern/state-2.json`
  - Runtime errors: none emitted in this run.
- Added melee attacks on left click for `knife_01` and `baseball_bat_01`:
  - New per-weapon melee config in `src/game.js` (range, cooldown, swing duration, swing motion offsets).
  - Added left-click pointer handler gated to active first-person gameplay.
  - Added melee hit-scan raycast against walls/props/pickups/exit marker and status text feedback (`hit ...` / `missed`).
  - Added swing animation blending on the held-item rig and per-frame cooldown updates.
  - Added melee state fields in `render_game_to_text` (`flags.meleeSwinging`, `flags.meleeCooldownSeconds`, `selectedInventory.meleeAttack`).
- Updated control copy to mention melee:
  - `index.html` start overlay now lists `Melee (knife/bat): Left Click`.
  - `src/config.js` gameplay hint now mentions left-click melee.
- Validation notes:
  - Skill client run saved `output/melee-leftclick-client/shot-*.png` and `state-*.json` with no `errors-*.json`, but the scripted click did not consistently press `Enter Maze` in this environment.
  - Added focused Playwright verification with deterministic stepping and debug inventory:
    - Screenshots: `output/melee-validation/knife-swing.png`, `output/melee-validation/bat-swing.png`
    - State trace: `output/melee-validation/states.json`
    - Console/page errors: none (`output/melee-validation/console-errors.json` not created)
  - Confirmed in state trace:
    - Knife left-click sets `flags.meleeSwinging=true` and non-zero cooldown, then returns to idle.
    - Rotating selection to bat and left-clicking does the same with bat-specific cooldown/range metadata.
- Added pistol firing on left-click when `pistol_01` is selected:
  - New pistol combat state in `src/game.js` (`pistolFireCooldownRemaining`, `pistolInfiniteAmmo`) and left-click routing to pistol first, melee fallback.
  - Default pistol behavior consumes one `bullet_01` per shot; empty magazine blocks firing with status feedback.
  - Pressing `I` (debug inventory loadout) now enables infinite pistol ammo as requested.
- Added bullet impact decals with `DecalGeometry`:
  - Imported `DecalGeometry` from `three/addons/geometries/DecalGeometry.js`.
  - Loaded CC0 bullet-hole texture at `assets/textures/decals/bullet-hole-impact-cc0.png`.
  - Spawned decals on pistol hits against wall/prop meshes with capped decal count and cleanup on maze regenerate.
- Added attribution for decal texture in `assets/textures/CREDITS.md`:
  - Source: OpenGameArt `Bullet Decal` by musdasch (CC0 1.0).
- Added additional debug/test observability:
  - `render_game_to_text` now includes pistol/ammo/decal state (`flags.pistolInfiniteAmmo`, `flags.pistolCooldownSeconds`, `ammo`, `decals`).
  - Added debug hooks:
    - `window.__debugSetPistolInfiniteAmmo(enabled)`
    - `window.__debugGetPistolInfiniteAmmo()`
    - `window.__debugGetBulletAmmoCount()`
    - `window.__debugGetBulletDecalCount()`
- Validation runs:
  - Skill client smoke: `output/pistol-smoke-client/shot-0.png`, `output/pistol-smoke-client/state-0.json` (no `errors-*.json`).
  - Focused pistol validation:
    - Screenshots: `output/pistol-validation/finite-first-shot.png`, `output/pistol-validation/infinite-shots.png`
    - State trace: `output/pistol-validation/states.json`
    - Confirmed behavior:
      - Finite mode: ammo `1 -> 0` after first shot, second shot blocked at `0`, decals unchanged on blocked shot.
      - Infinite mode after `I`: ammo stays constant while shots continue and decal count increases (`1 -> 3` in run).
    - Console/page errors: none (`output/pistol-validation/console-errors.json` not created).
- Extended pistol impact/debug/FX behavior:
  - Added floor + ceiling hit classification and decal placement in `src/game.js`.
  - Enforced bullet decal cap to 10 with FIFO eviction (oldest decal removed when a new one exceeds cap).
  - Added debug interactions for props (`window.__debugShootPistolAtNearestProp()` + hit/status reporting).
  - Added pistol impact debug toggle on `P`; overlay/config hints updated to mention this control.
  - Added dual decal material modes:
    - non-debug: `MeshStandardMaterial` (decals fade in dark corridor with scene lighting)
    - debug: `MeshBasicMaterial` (decals remain clearly visible while debugging)
  - Added fallback plane decals for instanced/unsupported surfaces to keep prop impacts visible.
  - Added pistol firing animation/FX:
    - strong left-hand recoil kick with smooth return
    - timed muzzle flash sprite + short-lived muzzle point light
  - Added pistol state observability in `render_game_to_text`: `flags.pistolImpactDebug`, `flags.pistolRecoil`, `flags.pistolMuzzleFlash`, and `pistol.lastHit`.
- Follow-up validation (SwiftShader Playwright run):
  - Artifacts: `output/pistol-v3-validation/states.json`, `output/pistol-v3-validation/material-types.json`, `output/pistol-v3-validation/floor-hit.png`, `output/pistol-v3-validation/ceiling-hit.png`.
  - Confirmed:
    - floor hit: `type=floor`, `decalSpawned=true`
    - ceiling hit: `type=ceiling`, `decalSpawned=true`
    - prop debug shot: `type=prop`, `decalSpawned=true`
    - decal cap holds at `10` after burst shots
    - recoil + muzzle flash state spike on shot then decay (`pistolRecoil`, `pistolMuzzleFlash`)
    - decal material switches by debug mode (`MeshBasicMaterial` debug on, `MeshStandardMaterial` debug off)
  - No console/page error files were produced in this run.
- Decal orientation/ceiling fix follow-up:
  - Looked up the official three.js decals example (`examples/webgl_decals.html`) and matched its projection approach:
    - orient a helper/projector with `lookAt(hitPoint + normal)` and use that rotation for `DecalGeometry`.
  - Reworked bullet decal transform code in `src/game.js`:
    - added `resolveBulletDecalSurfaceNormal(...)` (instance-aware world-space normal extraction for instanced props),
    - added backface correction (`if dot(normal, shotDir) > 0 => flip`) so ceiling/backside hits project toward the visible side instead of clipping behind geometry,
    - added `resolveBulletDecalTransformFromHit(...)` to centralize position/orientation and random roll for both `DecalGeometry` and fallback plane decals.
  - Updated debug impact marker to use the same corrected world normal logic.
  - Set both decal materials to `side: THREE.DoubleSide` to avoid winding-related ceiling visibility misses.
- Validation after follow-up:
  - Skill smoke reruns:
    - `output/pistol-v4-smoke-client/shot-0.png`, `state-0.json`
    - `output/pistol-v4b-smoke-client/shot-0.png`, `state-0.json`
  - Focused validation:
    - `output/pistol-v4-validation/states.json`, `material-types.json`
    - `output/pistol-v4-validation/floor-hit.png`
    - `output/pistol-v4-validation/ceiling-hit.png`
    - `output/pistol-v4-validation/prop-hit.png`
  - Confirmed in `states.json`:
    - ceiling hits still classify correctly (`type=ceiling`) with `decalSpawned=true`,
    - prop debug hits still classify (`type=prop`) with `decalSpawned=true`,
    - no console/page error files emitted in this run.
- Muzzle flash alignment + point-light shader-stall prevention:
  - Reworked muzzle flash transform so sprite/light are positioned from the held pistol model muzzle each frame instead of a fixed rig offset:
    - computes muzzle position from cached local bounds on the normalized pistol model,
    - projects support point along current camera-forward direction in pistol local space,
    - falls back to prior fixed local offset when pistol model is unavailable.
  - Moved muzzle flash light to scene root and prewarmed it:
    - `scene.add(pistolMuzzleFlashLight)` at startup,
    - `visible=true` permanently,
    - idle state uses `intensity=0` (no first-toggle shader compile stall).
  - Muzzle flash sprite also moved to scene root and follows the same computed world muzzle position for alignment parity with the light.
  - Added debug observability hooks:
    - `window.__debugGetMuzzleFlashLightState()`
    - `window.__debugGetMuzzleFlashSpriteWorldPosition()`
- Validation for this follow-up:
  - Skill smoke run: `output/pistol-v5-smoke-client/shot-0.png`, `state-0.json`.
  - Focused muzzle checks: `output/pistol-v5-muzzle-check/states.json`, `muzzle-shot.png`.
  - Confirmed from `states.json`:
    - muzzle light is pre-added and remains `visible=true` with `intensity=0` at rest,
    - sprite/light world positions are identical (`alignment=0`) for consistent muzzle alignment.
  - No console/page error files were produced in this run.
- Muzzle end flip follow-up:
  - Flipped muzzle-direction solve to the opposite pistol end in `resolvePistolMuzzleWorldPosition()` (negated local muzzle direction once after converting camera-forward into model-local space).
  - Validation:
    - `output/pistol-v5b-muzzle-flip-check/state.json`
    - `output/pistol-v5b-muzzle-flip-check/shot.png`
  - Confirmed:
    - flash moved to the opposite side of the pistol relative to previous solve,
    - sprite/light still remain exactly aligned (`alignmentDist=0`),
    - light prewarm behavior unchanged (`visible=true`, idle `intensity=0`).
- Muzzle visibility robustness follow-up:
  - Refined muzzle-point selection from box-corner support to end-face center on the dominant local axis, then nudged outward; avoids hidden/embedded flash points when using the flipped end.
  - Added a small world-forward push (`PISTOL_MUZZLE_FORWARD_WORLD_OFFSET`) to keep the flash slightly in front of the muzzle plane.
  - Improved low-FPS flash readability:
    - increased `PISTOL_MUZZLE_FLASH_DURATION` from `0.06` to `0.11`,
    - changed flash decay order to render current strength before decrementing remaining life (so the first rendered frame after a shot is not dimmed by delta subtraction).
  - Validation:
    - `output/pistol-v5e-muzzle-loaded/state.json`, `shot.png` (model-loaded path)
    - `output/pistol-v5f-flash-visibility/state.json`, `shot.png`
  - Confirmed:
    - sprite/light remain aligned and co-located while firing,
    - flash intensity/opacity now remain visible across multiple stepped frames (`16ms`, `66ms`) before settling to zero.
- Replaced procedural muzzle flash texture with CC0 image asset:
  - Downloaded OpenGameArt CC0 texture `muzzleFlash0_0.png` to:
    - `assets/textures/light/muzzle-flash-sheet-cc0.png`
  - Updated `src/game.js` to remove canvas-generated muzzle flash texture and load the CC0 file via `TextureLoader`.
  - Configured the texture as a single-frame sprite from the 4-frame horizontal strip (`repeat.x = 0.25`, `offset.x = 0.25`) to preserve the existing flash behavior/style.
  - Added attribution to `assets/textures/CREDITS.md`:
    - Asset: Muzzle Flash Particle (OpenGameArt, creator `doug`, CC0 1.0)
    - Source page + original direct file URL.
  - Validation:
    - Skill smoke run output: `output/muzzle-cc0-smoke-client/shot-0.png`, `output/muzzle-cc0-smoke-client/state-0.json`
    - No `errors-*.json` emitted in this run.
- Randomized muzzle flash frame selection per pistol shot:
  - Added muzzle flash sheet constants (`frameCount=4`, `frameWidth=0.25`) and switched texture setup to derive repeat/offset from those constants.
  - Added `randomizePistolMuzzleFlashFrame()` and call it inside `tryShootPistol()` right before flash lifetime starts, so each shot picks a random frame from the 4-frame strip.
  - Added debug getter `window.__debugGetMuzzleFlashFrame()` for automation checks.
  - Fixed a temporary init regression during implementation (`Cannot access 'PISTOL_MUZZLE_FLASH_FRAME_WIDTH' before initialization`) by moving frame constants above texture setup.
  - Validation:
    - Clean skill smoke run: `output/muzzle-random-frames-smoke-client-v2/shot-0.png`, `state-0.json` (no `errors-0.json` file).
    - Focused randomization check: `output/muzzle-random-frame-validation/state.json`, `shot.png`.
    - Confirmed random selection across all frames in a 20-shot burst:
      - `uniqueFrames: [0, 1, 2, 3]`
      - `uniqueCount: 4`

## TODO
- Optional: add touch controls (virtual joystick/look) for mobile playability beyond layout compatibility.
- Optional: add additional wall/floor texture variations and props for richer Wolfenstein-era styling.
- Optimized POM shader path and benchmarked impact using headless Playwright + SwiftShader with render-count FPS probe (`window.__mazePerf.renderedFrames`) over fixed windows.
- Added lightweight perf instrumentation: `window.__mazePerf = { renderedFrames, startTimeMs }`, incremented once per rendered frame in `animationFrame`.
- POM optimization changes:
  - Added floor/ceiling-specific POM layer budgets (`FLOOR_POM_MIN/MAX_LAYERS=2/6`, `ROOF_POM_MIN/MAX_LAYERS=2/6`) while keeping wall quality controls separate.
  - Replaced expensive `pow(luma, 1.2)` in height sampling with cubic smoothstep shaping (`h*h*(3-2*h)`).
  - Added early-out for tiny projected parallax (`length(proj) * heightScale <= 0.0015`) to skip raymarch where effect is visually negligible.
  - Reduced binary refinement iterations from 5 to 3.
  - Simplified analytic gradient offset term by dropping `d(finalTravel)` contribution and keeping camera-projection-driven derivative term.
- Benchmark (pre-optimization, same script shape, 1280x720, 5s windows):
  - `pom=0.000`: 1.5996 FPS
  - `pom=1.000`: 1.3996 FPS
- Benchmark (post-optimization, same harness):
  - `pom=0.000`: 1.9994 FPS
  - `pom=1.000`: 1.5999 FPS
- Observed in this environment: approx +25.0% at `pom=0` and +14.3% at `pom=1` versus the earlier baseline run.
- Added fixed inventory selection outline behavior (gold selector remains fixed at top while blue slots rotate into it), and bound `I` to populate one-of-each debug inventory.
- Added deterministic debug hooks for browser automation:
  - `window.__debugGrantInventory()`
  - `window.__debugRotateInventory(step)`
  - `window.__debugGetSelectedInventoryId()`
- Tuned held-item display for all eight pickup IDs via `HELD_ITEM_DISPLAY_TUNING` (per-item size/offset/rotation), and added camera-attached held-item inspection lighting to improve visibility during tuning.
- Ran Playwright-based item-cycling capture loops and reviewed resulting screenshots:
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/item-tuning-pass4/*.png`
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/item-tuning-pass5/*.png`
- Ran skill client sanity pass:
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/item-tuning-client/shot-0.png`
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/item-tuning-client/state-0.json`
  - No `errors-*.json` produced in this run.
- Bat two-hands flashlight behavior update:
  - Added `BASEBALL_BAT_ITEM_ID` and flashlight gating helpers in `src/game.js`:
    - `isFlashlightSuppressedByTwoHandedBat()`
    - `isFlashlightEmissionActive()`
  - When bat is selected, first-person render now hides `flashlightModelAnchor`.
  - Flashlight beam + bounce now use effective emission state (`flashlightEnabled && !batSelected`) so the light is off while holding the bat.
  - Updated `toggleFlashlight()` messaging to indicate the flashlight is stowed while using the bat.
  - Updated `render_game_to_text` flags:
    - `flags.flashlightOn` now reports effective runtime emission state.
    - Added `flags.flashlightSuppressedByTwoHandedBat`.
- Validation artifacts:
  - Skill smoke run: `output/bat-twohands-smoke/shot-0.png`, `output/bat-twohands-smoke/state-0.json` (client did not reliably enter maze from scripted click in this env, same known behavior as prior runs).
  - Focused Playwright validation (with SwiftShader args):
    - Screenshots:
      - `output/bat-twohands-validation/after-grant.png`
      - `output/bat-twohands-validation/after-select-bat.png`
      - `output/bat-twohands-validation/after-back-to-knife.png`
    - State trace: `output/bat-twohands-validation/states.json`
    - Confirmed in-state transitions:
      - Knife selected: `flashlightOn=true`, `flashlightSuppressedByTwoHandedBat=false`
      - Bat selected: `flashlightOn=false`, `flashlightSuppressedByTwoHandedBat=true`
      - Back to knife: `flashlightOn=true`, `flashlightSuppressedByTwoHandedBat=false`
- Added player health system + mirrored radial HUD meter:
  - New health HUD on the left side in `index.html` (`#health-wheel`) positioned symmetrically to inventory.
  - Implemented circular outline progress fill using a conic-gradient ring (`#health-ring`) with center heart + numeric readout (`#health-value`).
  - Added key hint copy updates to include `T` test damage.
- Implemented health state and test-damage input in `src/game.js`:
  - Added `PLAYER_MAX_HEALTH = 120`, `PLAYER_TEST_DAMAGE_PER_PRESS = 5`, and `playerHealth` state.
  - Added health helpers: `clampPlayerHealth`, `setPlayerHealth`, `applyPlayerDamage`, and `updateHealthHud`.
  - Bound `KeyT` to apply 5 damage and update status text.
  - Health resets to full on maze regenerate.
  - Added debug helpers:
    - `window.__debugGetPlayerHealth()`
    - `window.__debugSetPlayerHealth(value)`
    - `window.__debugDamagePlayer(amount)`
- Updated gameplay hint in `src/config.js` to mention `T` test damage.
- Added health telemetry to `render_game_to_text`:
  - `flags.playerDead`
  - `health: { current, max, ratio, percent }`
- Validation artifacts:
  - Skill smoke run:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-smoke-client/shot-0.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-smoke-client/state-0.json`
  - Focused health validation (Playwright + SwiftShader):
    - Screenshots:
      - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-validation/health-start.png`
      - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-validation/health-after-1t.png`
      - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-validation/health-after-3t.png`
    - State trace:
      - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-validation/states.json`
      - confirmed `120 -> 115 -> 105` after 0/1/3 presses of `T`
    - HUD CSS state:
      - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-validation/hud-state.json`
      - confirmed ring variable at `87.500` and text `105/120` after 3 presses.
    - No console/page errors (`errors.json` not produced).
- Health HUD visual upgrade pass:
  - Increased health ring path thickness (from ~9px to ~14px) and strengthened track styling.
  - Split health ring into layered fill + damage-trail arcs (`#health-ring-fill`, `#health-ring-loss`) so recent damage appears as a white radial segment.
  - Added damage-trail animation state in `src/game.js`:
    - `playerHealthDamageTrail`
    - `playerHealthDamageTrailHoldRemaining`
    - decay/hold constants (`HEALTH_DAMAGE_TRAIL_DECAY_PER_SECOND`, `HEALTH_DAMAGE_TRAIL_HOLD_SECONDS`)
    - `updateHealthDamageTrail(deltaSeconds)` called from `update(...)`.
  - Result: when health drops, the red bar updates immediately while the white segment shrinks over time toward the new health value.
- Replaced center heart emoji with anatomical heart image + numeric health value:
  - New image: `assets/textures/ui/anatomical-heart-cc0.png` (Openclipart, CC0 1.0).
  - HUD center now displays heart image and just the current numeric health value.
- Updated attribution:
  - Added `Health HUD Heart Icon` section to `assets/textures/CREDITS.md` with asset page, creator, license, and source URL.
- Validation artifacts:
  - Skill smoke:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-ring-thick-smoke-client/shot-0.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-ring-thick-smoke-client/state-0.json`
  - Focused ring animation validation:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-ring-animation-validation/health-start.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-ring-animation-validation/health-after-damage-early.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-ring-animation-validation/health-after-damage-late.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-ring-animation-validation/trace.json`
  - Confirmed from trace:
    - after damage: `health.current=115`, `health.trail=120`
    - later: `health.current=115`, `health.trail=119.15` (white trail decreases toward the red health value)
    - HUD CSS vars reflect this (`lossEnd` decreases from `100.000` to `99.292`).
  - No runtime errors (`errors.json` not produced).
- Additional deterministic animation check (using `window.advanceTime(1000)` in Playwright):
  - immediate after `T`: `health.current=115`, `health.trail=120`
  - after 1s simulated time: `health.current=115`, `health.trail=115`
  - confirms white trail segment fully converges to current health over time in normal frame-stepped gameplay.
- Heart asset swap requested by user:
  - Replaced center icon with Wikimedia file `Red_heart_illustration.png` from:
    - `https://commons.wikimedia.org/wiki/File:Red_heart_illustration.png`
    - direct file: `https://upload.wikimedia.org/wikipedia/commons/9/90/Red_heart_illustration.png`
  - Updated HUD center to remove numeric health readout (image-only center).
  - Enlarged center container and icon so heart spans most of the inner circle.
  - Updated `assets/textures/CREDITS.md` attribution for the new Wikimedia/RawPixel CC0 heart icon.
- Validation artifacts for this swap:
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-heart-swap-validation/menu.png`
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-heart-swap-validation/game-after-damage.png`
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-heart-swap-validation/state.json`
  - Confirmed in state: `hasValueNode=false`, `heartSrc=./assets/textures/ui/red-heart-illustration.png`, heart size `74x74` inside center `98x98`.
- Heart transparency cleanup follow-up:
  - Removed residual opaque speckle fragments from `assets/textures/ui/red-heart-illustration.png` by retaining only the primary connected foreground component.
  - Result: true transparent background in the HUD (no visible square/white background around the heart in gameplay).
- Heartbeat validation follow-up:
  - Kept periodic heart beat implementation in `src/game.js` (`updateHealthHeartBeatVisual` + heartbeat constants).
  - Verified frame-stepped beat scale changes via Playwright sampling:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-heartbeat-final-check/heartbeat-step-samples.json`
    - Observed scale range: `min=1.0000`, `max=1.1799`.
  - Verified final in-game visual:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-heartbeat-final-check/screen-final.png`
- Health damage-trail decay model update:
  - Switched white radial loss segment decay from linear to exponential in `src/game.js`.
  - Replaced fixed per-second subtraction with multiplicative decay toward current health using:
    - `HEALTH_DAMAGE_TRAIL_DECAY_RATE`
    - `HEALTH_DAMAGE_TRAIL_MIN_DELTA` snap threshold.
  - Hold phase remains unchanged (`HEALTH_DAMAGE_TRAIL_HOLD_SECONDS`), then trail eases down exponentially.
- Validation for exponential decay:
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-exponential-decay-validation/trace.json`
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-exponential-decay-validation/game.png`
  - Confirmed:
    - post-hold trail drop deltas shrink over time (`1.106 -> 0.803 -> 0.583 -> ... -> 0.162`)
    - `tailGetsSmaller=true`, `monotonicDropAfterHold=true`
  - No runtime errors in this run (`errors.json` not produced).
- Added jerky hold-to-consume interaction:
  - New behavior in `src/game.js` for selected `meat_jerky_01`:
    - hold left click for `2.0s` to consume,
    - consume removes the jerky from inventory,
    - player heals `+60` health (clamped by max health),
    - releasing early cancels consume.
  - Added center-screen consume HUD in `index.html`:
    - `#consume-progress` + label + fill track,
    - visible only while actively holding-to-eat.
  - Left-click routing now prioritizes jerky consume start before pistol/melee logic.
  - Added pointer-up/pointer-cancel/blur/unlock/regenerate cancellation paths so consume state cannot stick.
  - Added debug state hook:
    - `window.__debugGetJerkyConsumeState()`
  - Added jerky consume telemetry to `render_game_to_text`:
    - `flags.jerkyConsumeActive`, `flags.jerkyConsumeProgress`
    - `selectedInventory.consumable` metadata when jerky is selected.
- Updated help copy:
  - `index.html` overlay controls now mention hold-left-click to eat jerky.
  - `src/config.js` gameplay hint now includes jerky hold use.
- Validation artifacts:
  - Focused behavior validation:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/jerky-consume-validation/trace.json`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/jerky-consume-validation/during-hold.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/jerky-consume-validation/after-consume.png`
  - Smoke run with skill client:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/jerky-smoke-client/shot-0.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/jerky-smoke-client/state-0.json`
  - Confirmed in focused trace:
    - At `1.0s` hold: health unchanged, progress HUD active (`50%`), jerky still present.
    - After completion (`>2.0s`): health `+60`, jerky removed from inventory, consume HUD hidden, consume state inactive.
  - No runtime errors in these runs (`errors.json` not produced).
- Consume HUD visibility refinement:
  - Removed fade transition dependency on `#consume-progress` opacity and added stronger panel styling so the center progress bar remains visible in deterministic frame-stepped runs.
  - Validation rerun:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/jerky-consume-validation-v2/during-hold.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/jerky-consume-validation-v2/after-consume.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/jerky-consume-validation-v2/trace.json`
  - Confirmed: mid-hold HUD opacity is `1`, label is present, fill is `50%`, and consume completion still heals/removes jerky.
- Consumables expansion pass:
  - Jerky use animation:
    - While jerky is actively being eaten (hold left click), the held item now bobs up/down (plus subtle depth motion) via `updateConsumableUseVisuals()` in `src/game.js`.
  - First aid kit use:
    - Left click with `first_aid_kit_01` now consumes the kit and applies:
      - immediate heal: `+120` (clamped to max),
      - regeneration buff: `4 health/sec` for `30s`.
  - Soda can use:
    - Left click with `soda_can_01` now consumes the can and applies:
      - speed buff: `+50%` movement speed (`x1.5`) for `30s`.
  - Buff HUD:
    - Added a top-right soda boost icon/timer badge in `index.html` (`#soda-boost-indicator`) that appears while soda boost is active.
  - Input routing:
    - Left click now routes as:
      - jerky hold consume,
      - instant consumables (first aid/soda),
      - pistol fire,
      - melee.
  - Added debug/telemetry:
    - `window.__debugGetConsumableEffects()`
    - `window.__debugGetHeldItemAnchorOffset()`
    - `render_game_to_text` now includes consumable effect flags and selected-consumable metadata.
  - Updated control/help copy in:
    - `index.html` overlay controls line,
    - `src/config.js` gameplay hint.
- Validation artifacts:
  - Focused integration:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-v2-validation/trace.json`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-v2-validation/jerky-during.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-v2-validation/soda-active.png`
  - Skill smoke run:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-smoke-client/shot-0.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-smoke-client/state-0.json`
  - Confirmed checks in focused trace:
    - jerky bobs while eating (`anchorYRange=0.064`),
    - jerky consumes after hold and heals correctly,
    - first aid consumes, immediately heals, and starts regen timer,
    - regen heals at expected rate over stepped time,
    - soda consumes, starts `x1.5` speed effect, shows top-right icon, and timer counts down.
  - No runtime errors (`errors.json` not produced).
- Added instant-consumable bob parity (first aid + soda):
  - Implemented a short shared bob pulse timer (`instantConsumableBobRemaining`) so first aid kit and soda can now use the same bob animation style as jerky when activated.
  - Triggered on `useFirstAidKit()` and `useSodaCan()` via `triggerInstantConsumableBob()`.
  - `updateConsumableUseVisuals()` now applies bob when:
    - jerky hold-consume is active, or
    - instant consumable bob pulse is active.
  - Added debug/telemetry fields:
    - `window.__debugGetConsumableEffects().instantConsumableBobRemaining`
    - `flags.instantConsumableBobSeconds` in `render_game_to_text`.
- Validation for instant-consumable bob:
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-bob-validation/trace.json`
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-bob-validation/first-aid-bob.png`
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-bob-validation/soda-bob.png`
  - Confirmed checks:
    - `firstAidBobVisible=true`
    - `sodaBobVisible=true`
    - bob timer starts for both item uses.
  - No runtime errors in this run (`errors.json` not produced).
- Consumable timing + buff HUD refinement:
  - Added top-right regen indicator/timer alongside soda indicator in `index.html` (`#regen-indicator`, `#regen-timer`).
  - Reworked consumable use flow so jerky/first-aid/soda all use hold-to-consume:
    - jerky: `2s`,
    - first aid kit: `4s`,
    - soda can: `1s`.
  - Left-click now starts a timed consume for any selected consumable and uses the same center progress bar + label, canceling on release/unlock/blur.
  - Slowed consume bob animation by reducing `JERKY_EAT_BOB_FREQUENCY` (`6.8 -> 3.6`), and applied this bob consistently while any consumable is being consumed.
  - Added first-aid and soda consume durations to selected-consumable telemetry in `render_game_to_text`.
  - Updated gameplay/control copy to reflect hold-to-consume behavior for all three consumables.
- Validation for this refinement:
  - Focused integration:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-v3-validation/trace.json`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-v3-validation/final.png`
  - Skill smoke:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-v3-smoke-client/shot-0.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/consumables-v3-smoke-client/state-0.json`
  - Confirmed checks:
    - first aid not consumed at `2s`, consumed after `4s`,
    - soda not consumed at `0.5s`, consumed after `1s`,
    - regen indicator visible while regen active,
    - soda indicator visible while boost active,
    - jerky still consumes at `2s`.
  - No runtime errors in these runs (`errors.json` not produced).
- Inventory slot preservation fix:
  - Changed item consumption/removal to clear slot entries (`null`) instead of compacting with `splice`, so using an item leaves a blank in-place slot.
  - Updated inventory occupancy logic to count non-empty slots (instead of raw array length), and pickup now fills the first empty slot.
  - Updated bullet consumption to clear bullet slots without shifting other items.
  - Updated inventory serialization in `render_game_to_text` to skip empty slots safely.
- Validation for slot preservation:
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/inventory-slot-preserve-validation/trace.json`
  - `/Users/natebreslow/Documents/analogHorrorAtHome/output/inventory-slot-preserve-validation/after-consume.png`
  - Confirmed:
    - selected jerky slot becomes empty after use (`selectedAfterIsBlank=true`)
    - no auto-switch to another item
    - HUD count decrements to `7/8`
    - jerky removed from inventory payload.
  - Smoke run:
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/inventory-slot-smoke-client/shot-0.png`
    - `/Users/natebreslow/Documents/analogHorrorAtHome/output/inventory-slot-smoke-client/state-0.json`
  - No runtime errors in these runs (`errors.json` not produced).
- Refactored `src/game.js` into a modular composition root + subsystem architecture so no source file exceeds 600 lines:
  - New app entry/composition: `src/game/app.js`
  - Runtime bootstrap: `src/game/setupRuntime.js`
  - Shared constants and DOM queries: `src/game/constants.js`, `src/game/domRefs.js`
  - Systems split by domain:
    - `src/game/systems/worldSystem.js`
    - `src/game/systems/playerViewSystem.js`
    - `src/game/systems/flashlightSystem.js`
    - `src/game/systems/inventorySystem.js`
    - `src/game/systems/heldItemDisplaySystem.js`
    - `src/game/systems/healthConsumableSystem.js`
    - `src/game/systems/pistolSystem.js`
    - `src/game/systems/pistolDecalSystem.js`
    - `src/game/systems/meleeSystem.js`
  - Debug/state serialization split out: `src/game/debugApi.js`, `src/game/renderGameToText.js`, `src/game/utils.js`
  - `src/game.js` is now a 3-line bootstrap (`createGameApp()` call).
- Verified line-count target for source files (`src/**`): max is now 561 lines (`src/game/app.js`), all under 600.
- Validation loop:
  - Ran develop-web-game Playwright client (`web_game_playwright_client.js`) with click choreography and captured artifacts in `output/refactor-client-start/` and `output/web-game/`.
  - Added targeted Playwright smoke validation with explicit gameplay flow + debug hooks and SwiftShader flags:
    - Artifacts: `output/refactor-validation/gameplay-after-refactor.png`, `output/refactor-validation/state-before.json`, `output/refactor-validation/state-after.json`, `output/refactor-validation/console-errors.json`.
    - Confirmed: mode transitions to `playing`, movement displacement > 0, pistol selected/fire path works, decal count increments, and no console/page errors.
- Notes / TODO:
  - `package.json` remains `"type": "commonjs"` while browser code is ESM; this is unchanged from prior state but makes Node-based static checks noisy.
  - Could add lightweight browser CI smoke test script using the same SwiftShader flags to guard against future wiring regressions.
- Removed top-of-screen debug/status text:
  - Removed `Stats.js` FPS overlay creation + per-frame updates (`src/game/setupRuntime.js`, `src/game/app.js`).
  - Cleared the default top status hint (`GAMEPLAY_HINT` now empty) and removed the startup "Click Enter Maze..." status assignment.
  - Made initial startup maze generation silent so no "New maze generated." status text appears on first load (manual `N` regenerate still reports status).
- Validation for top-text removal:
  - Ran develop-web-game Playwright client: `node /Users/natebreslow/.codex/skills/develop-web-game/scripts/web_game_playwright_client.js --url http://127.0.0.1:4173/index.html --click "10,10" --iterations 1 --pause-ms 120 --screenshot-dir output/debug-overlay-removal`.
  - Verified `/Users/natebreslow/Documents/analogHorrorAtHome/output/debug-overlay-removal/shot-0.png` has no white debug/status text at the top.
- Health HUD sizing update (heart/radial fit):
  - Refactored `#health-wheel` CSS to use ring geometry variables (`--health-ring-inset`, `--health-ring-thickness`).
  - Set `#health-center` inset to `ring inset + ring thickness`, making the center circle match the radial ring’s exact inner diameter.
  - Set `#health-heart-image` to fill that center (`width/height: 100%`) with circular clipping via `#health-center`.
- Validation:
  - Ran develop-web-game Playwright capture into `output/health-center-size/`.
  - Verified visual result in `/Users/natebreslow/Documents/analogHorrorAtHome/output/health-center-size/shot-0.png`.
- Added stamina system tied to sprint:
  - New stamina constants in `src/game/constants.js`:
    - `PLAYER_MAX_STAMINA = 100`
    - `PLAYER_SPRINT_DURATION_SECONDS = 7`
    - `PLAYER_SPRINT_STAMINA_DRAIN_PER_SECOND = 100/7`
    - `PLAYER_STAMINA_REGEN_DELAY_SECONDS = 3`
    - `PLAYER_STAMINA_REGEN_PER_SECOND = 100/7`
    - low-stamina heartbeat tuning constants.
  - `src/game/systems/healthConsumableSystem.js` now tracks stamina state (`playerStamina`, regen delay, active sprint flag), drains while sprinting, and only regenerates after stamina has not decreased for 3 seconds.
  - `src/game/app.js` now computes actual sprint activity from movement input + stamina (`health.updateStamina`) and feeds that into movement, bobbing, and heartbeat updates.
  - `src/game/systems/playerViewSystem.js` now uses `isSprintActive` (actual sprint state) for speed multiplier and sprint bob scaling.
- Added stamina visualization on heart HUD:
  - `index.html` now layers a second heart image (`#health-heart-image-stamina`) with grayscale filter.
  - The overlay is clipped from the bottom using `--stamina-heart-gray-bottom-inset`, so the top `(100 - stamina%)` of the heart is gray.
  - Example behavior: at 70% stamina, clip is `inset(... 70%)` so top 30% is gray.
  - Wired DOM ref in `src/game/domRefs.js` and updates in `healthConsumableSystem.updateStaminaHud()`.
- Added requested heartbeat behavior:
  - When sprinting and stamina is below 20%, heartbeat frequency is significantly increased (`STAMINA_LOW_SPRINT_HEARTBEAT_FREQUENCY_MULTIPLIER = 2.8`).
  - Heartbeat transform is applied to both base and stamina-overlay heart images so pulse remains synced.
- Extended `render_game_to_text` telemetry:
  - `flags.sprinting` now reports actual stamina-backed sprinting.
  - Added `flags.lowStaminaHeartbeatBoost`.
  - Added `stamina` object (`current`, `max`, `ratio`, `percent`, `regenDelaySeconds`).
- Validation:
  - Skill client run:
    - `output/stamina-system/shot-0.png`, `output/stamina-system/shot-1.png`
    - `output/stamina-system/state-0.json`, `output/stamina-system/state-1.json`
    - no `errors-*.json` produced.
  - Deterministic sprint/regen validation (Playwright + `window.advanceTime`) in `output/stamina-system-validation/stamina-report.json`:
    - after 3.5s sprint: stamina `50`
    - after 7.0s sprint: stamina `0`
    - after 2.0s rest: stamina still `0` (regen not started)
    - after 3.2s rest: stamina `5.952` (regen started after 3s delay)
    - low-stamina sprint heartbeat boost flag true at depleted sprint state.
  - Visual stamina-mask checks:
    - `output/stamina-system-validation/after-7s-sprint.png` (heart fully gray at 0 stamina)
    - `output/stamina-system-validation/at-70-stamina.png` + `at-70-stamina.json` (70% stamina, top 30% gray via `clipPath: inset(... 70%)`).
- Added inventory drop action on `Q`:
  - `src/game/app.js` now binds `KeyQ` to `inventory.dropSelectedItem()`.
  - `index.html` controls overlay now includes `Drop selected item: Q`.
- Implemented drop flow in `src/game/systems/inventorySystem.js`:
  - Added `dropSelectedItem()`.
  - Drops the currently selected item in front of the player (camera-forward, slight lateral jitter), removes it from the selected slot, updates HUD/prompt, and posts a status message.
- Implemented world re-spawn API in `src/world/pickups.js`:
  - Added `dropItemById(id, position)` to spawn a pickup instance back into the scene at a target location.
  - Added `instantiatePickupFromTemplate(...)` helper so dropped pickups match normal pickups (scale range, ground placement, bob animation metadata).
- Validation:
  - develop-web-game skill client smoke run:
    - `output/drop-item-skill/shot-0.png`
    - `output/drop-item-skill/state-0.json`
    - no `errors-*.json` produced.
  - Deterministic drop/pickup validation (`output/drop-item-validation/drop-report.json`):
    - inventory count `8 -> 7` after `Q` drop,
    - inventory count `7 -> 8` after `E` pickup,
    - selected item dropped/picked back (`knife_01`),
    - status text confirms pickup,
    - no console/page errors.
  - Screenshot: `output/drop-item-validation/after-drop-and-pickup.png`.
- Added first-pass Wireman enemy follow system (`assets/models/wireman.glb`):
  - New system: `src/game/systems/wiremanSystem.js`.
  - Loads model from `./assets/models/wireman.glb`, normalizes scale/grounding, builds animation mixer, and maps clip roles by name (`idle`, `walk`, `run`, `sprint`, `attack`).
  - Added A* grid pathfinding in the Wireman system and repath timer to follow a target cell behind the player.
  - Wireman uses walk locomotion while moving and idle when within trailing stop distance.
- Integration:
  - `src/game/app.js` now creates the Wireman system, updates it each frame, and resets/respawns it on maze regeneration.
  - `src/game/constants.js` now includes wireman tuning constants (model path, walk speed, repath interval, follow distances, waypoint threshold, search radius, rotation speed, yaw offset).
  - `src/game/renderGameToText.js` now includes `wireman` telemetry (loaded/moving/animation/position/cell/path/goal/distances) for deterministic testing.
- Validation:
  - develop-web-game client run:
    - `output/wireman-skill/shot-0.png`
    - `output/wireman-skill/shot-1.png`
    - `output/wireman-skill/state-0.json`
    - `output/wireman-skill/state-1.json`
    - no `errors-*.json` emitted.
  - Deterministic gameplay/pathing validation (`output/wireman-validation/wireman-report.json`):
    - `wireman.loaded=true`, `wireman.moving=true`, `animation="walk"`.
    - player moved `~12.94` world units while wireman moved `~9.15` units.
    - `wireman.distanceToGoal` decreased (`-1.372`), confirming pursuit toward behind-player A* target.
    - no console/page errors.
  - Visual capture during follow run:
    - `output/wireman-validation/topdown-wireman.png`.
- Updated Wireman target behavior to track player position directly (not behind-player offset):
  - Removed behind-offset targeting in `src/game/systems/wiremanSystem.js`.
  - Wireman now computes goal cell from current player world position and paths directly to that cell.
  - Removed unused `WIREMAN_FOLLOW_OFFSET_DISTANCE` constant from `src/game/constants.js`.
- Validation:
  - `output/wireman-target-player-validation/wireman-target-player-report.json` confirms `afterGoalMatchesPlayer=true` with `wireman.goalCell == playerCell` and wireman movement > 0.
  - Top-down capture: `output/wireman-target-player-validation/topdown-wireman-target-player.png`.
- Added debug teleport key (`/`):
  - `src/game/app.js` now handles `Key code: "Slash"` and teleports player camera to Wireman's current position.
  - Added helper `teleportPlayerToWireman()` with loaded-state guard and status text.
  - Updated controls overlay in `index.html` to document `/` as "Teleport to Wireman".
- Validation:
  - develop-web-game skill smoke run:
    - `output/teleport-wireman-skill/shot-0.png`
    - `output/teleport-wireman-skill/state-0.json`
  - Deterministic check:
    - `output/teleport-wireman-validation/teleport-report.json`
    - confirms player-to-wireman distance changed from `~73.813` to `0` after pressing `/`.
    - status text: `Teleported player to Wireman.`
    - no console/page errors.
  - Screenshot: `output/teleport-wireman-validation/after-teleport.png`.
- Synced wireman movement speed with player base speed:
  - `src/game/constants.js`: `WIREMAN_WALK_SPEED` now derives from `playerSpeed` input.
  - `src/game/app.js`: `createGameConstants` now passes `playerSpeed: config.PLAYER_SPEED`.
  - Result: wireman and player base speeds stay matched automatically if `PLAYER_SPEED` is retuned.
- Skipped Playwright validation for this change per user request.
- Wireman LOS sprint behavior:
  - Added `WIREMAN_SPRINT_MULTIPLIER = 1.5` in `src/game/constants.js`.
  - Kept nerfed base speed `WIREMAN_WALK_SPEED = playerSpeed * 0.75`, so LOS sprint speed is now `1.5 * 0.75 * playerSpeed`.
  - Updated `src/game/systems/wiremanSystem.js`:
    - Added direct line-of-sight check from Wireman to player using sampled world-space walkability.
    - If LOS is clear, Wireman bypasses A* waypoint following and sprints directly at player.
    - If LOS is blocked, Wireman resumes normal A* pathing at walk speed.
    - Animation switches to `sprint` while LOS sprinting, otherwise `walk`/`idle`.
    - Added state flags: `sprinting` and `lineOfSightToPlayer`.
  - Updated `src/game/renderGameToText.js` to expose Wireman `sprinting` and `lineOfSightToPlayer` telemetry.
- Skipped Playwright validation for this iteration.
- Replaced Wireman’s fallback “A* directly to player cell” behavior with weighted hunt logic modeled after minotaur-style search:
  - Added `hunt` vs `chase` mode in `src/game/systems/wiremanSystem.js`.
  - Wireman now keeps per-cell hunt scores seeded by visibility richness (how many cells each tile can see).
  - While hunting, it ranks top-score tiles, computes path cost to each candidate, and roulette-selects a target using cubic weighting: `(score / pathLength)^3`.
  - As Wireman moves, it clears scores for tiles visible in its forward hemisphere from the current cell (searches/"checks" those spaces).
  - If it reacquires LOS, it switches to `chase` mode and directly pursues the player as before.
- Implemented maze visibility precomputation and world API plumbing:
  - Added `buildWalkableVisibilityMap(...)` in `src/world/maze.js`.
  - Visibility map stores, for every walkable tile, the set/list of walkable tiles mutually visible via static line-of-sight sampling.
  - `src/game/systems/worldSystem.js` now rebuilds this map on maze regeneration and exposes:
    - `getVisibilityMap()`
    - `getVisibleCellsForCell(col, row)`
    - `areCellsVisible(fromCol, fromRow, toCol, toRow)`
  - `src/game/app.js` now passes `buildWalkableVisibilityMap` into the world system.
- Added Wireman hunt telemetry for deterministic validation:
  - `src/game/renderGameToText.js` now includes `wireman.huntMode` and `wireman.huntTargetCell`.
- Validation:
  - develop-web-game skill client run:
    - `output/wireman-hunt-validation/shot-0.png`, `shot-1.png`, `shot-2.png`
    - `output/wireman-hunt-validation/state-0.json`, `state-1.json`, `state-2.json`
    - note: this run remained on the start overlay (`mode: paused`) because the scripted start click did not engage gameplay in that run.
  - Focused deterministic Playwright run (forced start click + stepped simulation):
    - `output/wireman-hunt-manual/shot.png`
    - `output/wireman-hunt-manual/state.json`
    - confirmed `wireman.huntMode="hunt"`, `moving=true`, `pathLength>0`, and active hunt target selection.
  - Chase-mode check (teleport to Wireman and step):
    - `output/wireman-hunt-chase-check/shot.png`
    - `output/wireman-hunt-chase-check/state.json`
    - confirmed `wireman.huntMode="chase"`, `lineOfSightToPlayer=true`, `goalCell==wireman.cell`, and zero separation after teleport.
  - No console/page error artifact files were produced in the focused manual/chase runs.
- Ported minotaur-style timestep score regeneration into Wireman hunt logic:
  - `src/game/systems/wiremanSystem.js` now keeps per-walkable-cell hunt scores initialized to `0.1` (matching minotaur maze cell-score max).
  - Added per-frame regeneration in Wireman update: `score += 0.00025 * deltaSeconds`, clamped to `0.1`.
  - Visible-forward cells are still set to `0` when Wireman scans/moves through a cell.
- Aligned target selection more closely with minotaur behavior:
  - Hunt candidate score is now computed as the sum of current scores of all cells visible from that candidate tile (same visibility-sum concept as `findTopVisibilityTiles` in theMinotaur).
  - Wireman picks from top candidates using roulette with cubic weighting `(visibilityScore / pathLength)^3`.
- Validation for this follow-up:
  - develop-web-game skill client run:
    - `output/wireman-hunt-decay-skill/shot-0.png`, `shot-1.png`
    - `output/wireman-hunt-decay-skill/state-0.json`, `state-1.json`
    - no `errors-*.json` emitted (this run remained paused on overlay).
  - Focused deterministic run (forced start + stepped sim):
    - `output/wireman-hunt-decay-manual/shot.png`
    - `output/wireman-hunt-decay-manual/state.json`
    - confirmed active hunt mode/pathing (`huntMode="hunt"`, `moving=true`, `pathLength>0`).
  - Chase-mode regression check:
    - `output/wireman-hunt-decay-chase-check/shot.png`
    - `output/wireman-hunt-decay-chase-check/state.json`
    - confirmed LOS chase still works (`huntMode="chase"`, `lineOfSightToPlayer=true`) after teleport.
- Added Wireman debug minimap overlay (Canvas2D) for AI introspection:
  - New top-left canvas in `index.html` (`#wireman-minimap`) with show/hide styling and control hint updated to include `H`.
  - Added DOM binding in `src/game/domRefs.js`.
  - `src/game/app.js` now renders a per-frame minimap when toggled:
    - maze walls/open cells,
    - hunt score heatmap (cell scores used by Wireman selection logic),
    - active path polyline,
    - player and Wireman markers,
    - goal/hunt target outlines,
    - chase/hunt mode header.
  - Added keybind: `H` toggles minimap visibility with status text.
- Exposed Wireman debug accessors for minimap rendering in `src/game/systems/wiremanSystem.js`:
  - `getHuntScoreForCell(col, row)`
  - `getPathCells()`
  - `getPathIndex()`
  - `getHuntScoreMax()`
- Validation:
  - develop-web-game skill client run:
    - `output/wireman-minimap-skill/shot-0.png`, `shot-1.png`
    - `output/wireman-minimap-skill/state-0.json`, `state-1.json`
    - no `errors-*.json` emitted (this run remained paused on the start overlay).
  - Focused deterministic minimap test (forced start + press `H`):
    - `output/wireman-minimap-manual/shot.png`
    - `output/wireman-minimap-manual/state.json`
    - `output/wireman-minimap-manual/minimap.json` confirms `display="block"` and `.visible` class after toggle.
  - Follow-up readability pass for path contrast:
    - `output/wireman-minimap-manual-v2/shot.png`
    - path line now high-contrast magenta over score heatmap.
- Wireman locomotion now uses `world.resolveWorldCollision(nextX, nextZ)` before committing position, so enemy movement is blocked by wall BVH and prop BVH colliders (same capsule collision pathway used by player movement).
- Wireman movement/animation state now derives from resolved displacement after collision (prevents movement state from reporting motion when fully blocked by geometry).
- Validation note: skipped Playwright by explicit user request; pending manual in-game collision verification.
- Added optional collider filtering to `world.resolveWorldCollision(x, z, options)` in `src/game/systems/worldSystem.js` (`includeWalls/includeProps`, both default true).
- Updated Wireman movement resolution in `src/game/systems/wiremanSystem.js` to call `resolveWorldCollision(nextX, nextZ, { includeProps: false })`, so Wireman is blocked by walls but can pass through props.
- Validation note: no Playwright run (per user preference); pending manual gameplay verification for anti-stuck behavior around props.
- Added simple jump mechanic on `Space`:
  - input state: `keyState.jump` tracked in `src/game/app.js` (`keydown`/`keyup`) and reset on maze regenerate.
  - movement/view: `src/game/systems/playerViewSystem.js` now simulates jump with vertical velocity + gravity (`PLAYER_JUMP_VELOCITY=5.2`, `PLAYER_JUMP_GRAVITY=14.5`) and applies jump offset to camera height.
  - jump is edge-triggered (press-to-jump while grounded) and resets when gameplay is inactive.
- Added jump state observability to `render_game_to_text` via `createRenderGameToText` (`flags.jumping`, `flags.grounded`, `player.jumpOffset`, `player.jumpVelocity`).
- Updated controls overlay in `index.html` to show `Jump: Space`.
- Validation note: no Playwright run (user will test manually).
- Jump/collision integration fix: jump now offsets the actual collision capsule height instead of only camera visuals.
  - `world.resolveWorldCollision(...)` now accepts `heightOffset` and applies it to capsule segment endpoints.
  - player movement now calls `resolveWorldCollision(nextX, nextZ, { heightOffset: jumpOffset })`.
  - jump simulation moved to `updatePlayerMovement` so collision uses current-frame jump state.
- Expected result: low props can be cleared while airborne if jump height exceeds obstacle height.
- Set Wireman collision capsule radius to `1.225` world units via new constant `WIREMAN_COLLISION_RADIUS` in `src/game/constants.js`.
- `world.resolveWorldCollision(...)` now supports per-call `collisionRadius` override (defaults to `PLAYER_RADIUS` when omitted).
- Wireman now passes `collisionRadius: WIREMAN_COLLISION_RADIUS` and `includeProps: false` when resolving movement collision.
- Updated Wireman LOS to require front hemisphere alignment before visibility checks.
  - In `hasDirectLineOfSight(...)`, added facing-vector dot gate (`forwardDot < 0 => false`) using `wiremanRig.rotation.y`.
  - This makes player detection LOS effectively 180 degrees in front, matching hunt-score front hemisphere behavior.
- Wireman LOS now varies by mode and distance:
  - `chase` mode: 360-degree LOS (no front-hemisphere gate).
  - `hunt/search` mode: 180-degree front hemisphere LOS by default.
  - close-range override: if player is within `WIREMAN_CLOSE_DETECTION_DISTANCE = 10`, Wireman can detect from any direction as long as geometric LOS is clear (not through walls).
- Implemented via `hasDirectLineOfSight(..., { requireFrontHemisphere })` + mode/distance rule in update loop.
- Search-mode target arrival behavior updated: Wireman now performs a full 360-degree in-place scan before giving up.
  - On reaching search target (`distance <= WIREMAN_FOLLOW_STOP_DISTANCE`), it enters a scan state and rotates by `WIREMAN_ROTATE_SPEED * dt` until one full turn is completed.
  - During scan, movement is paused (`idle` animation), and normal per-frame LOS checks continue; if player is spotted, it transitions to chase as usual.
  - If scan completes without spotting player, it transitions from `search` back to `hunt`.
- Added Wireman `attack` state behavior:
  - enters `attack` when Wireman has LOS and is within `WIREMAN_ATTACK_RANGE = 2` world units.
  - plays `attack` animation role while in range.
  - applies `WIREMAN_ATTACK_DAMAGE = 30` via `health.applyPlayerDamage(...)`, with `WIREMAN_ATTACK_COOLDOWN_SECONDS = 1.1` between hits to avoid per-frame damage spam.
- `createWiremanSystem` now accepts `applyPlayerDamage` callback; wired from app via `applyPlayerDamage: health.applyPlayerDamage`.
- Health clamping remains handled by existing health system (`setPlayerHealth`), so player HP bottoms at 0 as requested.
- Added player-wireman capsule collision resolution:
  - `wireman.resolvePlayerCapsuleCollision(...)` now separates both entities when their capsules overlap, using `PLAYER_RADIUS` and `WIREMAN_COLLISION_RADIUS`.
  - Separation respects jump offset by including a vertical-gap check so high jumps can reduce/avoid collision.
  - Hooked into main update loop after `wireman.update(...)` to keep camera and wireman from interpenetrating.
- Skipped Playwright validation in this iteration per user request.
- Added Wireman combat health/death loop:
  - New health constants: max health 360 and pistol damage 90.
  - Melee weapon configs now include per-hit damage (`knife_01`: 40, `baseball_bat_01`: 60).
  - `wiremanSystem` now tracks `health` and `dead`, exposes `getRaycastTarget`, `isHitObject`, and `applyDamage`.
  - Added `death` animation role (loop once, clamp at end). On death, Wireman enters `huntMode: "dead"`, stops all AI/pathing/attacks, and remains in place.
  - Player-vs-Wireman capsule collision is disabled once Wireman is dead.
- Integrated weapon hits against Wireman:
  - `meleeSystem` raycasts now include Wireman as a target and apply weapon-specific damage.
  - `pistolSystem` raycasts now include Wireman by default and apply 90 damage on hit.
  - Pistol hits on Wireman skip bullet-decal spawn.
- Updated app wiring to pass a `getWireman` callback into pistol/melee systems.
- Added Wireman `health`, `maxHealth`, and `dead` fields to `renderGameToText` output.
- Skipped Playwright validation in this iteration per user request.
- Replaced Wireman combat hit detection from mesh ray intersection to capsule ray intersection:
  - Added `wireman.raycastCapsule({ origin, direction, maxDistance })` using `THREE.Ray.distanceSqToSegment` against Wireman’s collision capsule.
  - Melee now compares nearest world-ray hit vs capsule hit distance and only damages Wireman if capsule is the closest valid hit.
  - Pistol now does the same nearest-hit arbitration; Wireman is no longer added to `Raycaster` object targets.
- Added cooldown-rest visual dip for player weapons:
  - Melee: when a melee weapon is selected, cooldown is active, and swing animation is not active, the held rig is shifted downward and smoothly rises as cooldown approaches zero.
  - Pistol: when pistol cooldown is active and pistol is no longer in its active shot animation window (muzzle flash/recoil threshold), the held rig is shifted downward and rises as cooldown clears.
- Refined cooldown dip implementation to be EMA-smoothed toward target Y-offset each frame (melee + pistol) to avoid abrupt vertical jumps when entering/exiting cooldown visuals.
- Melee cooldown baseline now applies during swing animation too, so swing-return settles toward the cooldown-lowered target pose instead of base pose.
- Melee cooldown offset is now gated to backswing (`swingProgress >= 0.5`) while preserving EMA smoothing, so initial forward swing target does not include cooldown dip.
- Reverted melee cooldown target behavior: cooldown Y-offset is no longer targeted during any part of the swing animation (including backswing); EMA cooldown dip only applies once swing is inactive.
- Added a compact crosshair cooldown bar UI under the crosshair:
  - Appears only while selected weapon cooldown is active (pistol or melee).
  - Fill progresses from 0% to 100% as cooldown recharges.
  - Hidden outside active first-person gameplay states.
- Added player death/game-over flow when health reaches zero during active gameplay:
  - New `isGameOver` runtime flag in `src/game/app.js`.
  - Wireman kill now triggers game-over state, unlocks pointer lock safely, shows a game-over overlay mode, and applies a red full-screen death tint.
  - Implemented death camera animation: camera falls from current height toward floor and rolls +90 degrees around the Z axis over a short ease-out.
  - Game-over restart flow uses the existing start button (`Try Again`) and regenerates the maze before re-entering.
- UI additions for game-over presentation:
  - Added `#death-tint` layer and overlay text hooks (`#overlay-title`, `#overlay-subtitle`, `#overlay-controls`) in `index.html`.
  - Added corresponding DOM refs in `src/game/domRefs.js`.
- Debug/state output update:
  - `render_game_to_text` now reports `mode: "game_over"` and `flags.gameOver` when dead.
- Added a win-screen flow when Wireman dies:
  - `app.js` now detects `wireman.getState().dead` during active play and triggers `hasWon` via `triggerWin()`.
  - Overlay mode now supports `win` (title/subtitle/button text update, controls text hidden).
  - Winning exits gameplay, unlocks pointer lock, hides crosshair, and shows restart overlay (`Play Again`).
  - Prevented click-to-resume from bypassing restart when in won/game-over states.
- Adjusted win-screen timing: win overlay now appears 5 seconds after Wireman dies.
  - Added `WIREMAN_WIN_SCREEN_DELAY_SECONDS = 5` countdown state in `app.js`.
  - Countdown starts once on Wireman death, status updates to `Wireman eliminated.`, and then `triggerWin()` fires after delay.
  - Countdown is reset on maze regeneration/restart and when win is finalized.
- Added gameplay SFX with online-sourced CC0 assets (BigSoundBank):
  - Downloaded and added local files under `assets/audio/sfx/`:
    - `footsteps_gravel.wav` (ID 0839)
    - `melee_miss_whoosh.wav` (ID 1801)
    - `melee_hit_wall.wav` (ID 0401)
    - `melee_hit_wireman.wav` (ID 2468)
    - `pistol_fire.wav` (ID 0397)
    - `eat_jerky.wav` (ID 1432)
    - `drink_soda.wav` (ID 0116)
  - Trimmed long source WAVs with ffmpeg to short gameplay-friendly clips.
- Added `src/game/systems/soundSystem.js`:
  - Pooled HTMLAudio playback, gesture-unlock gating, and dedicated play APIs per effect.
- Integrated sound triggers:
  - Footsteps: distance-based cadence in `app.js` while moving/grounded (walk vs sprint stride tuning).
  - Melee: miss / wall hit / wireman hit callbacks from `meleeSystem`.
  - Pistol: fire callback from `pistolSystem` on successful shot commit.
  - Consumables: jerky-eat and soda-drink callbacks from `healthConsumableSystem`.
- Added source/license documentation to `assets/audio/CREDITS.md` (CC0 asset pages + sound IDs).
- Replaced footstep SFX with the user-specified Freesound clip:
  - Source page: https://freesound.org/people/xmike80x/sounds/706207/
  - Local asset: `assets/audio/sfx/footsteps_freesound_706207.mp3` (HQ preview URL)
  - Updated `soundSystem` footsteps source to this MP3.
  - Updated `assets/audio/CREDITS.md` footsteps entry to Freesound + CC0 license.
- Updated jerky consume audio behavior to loop for the full hold-to-eat duration:
  - Added loop-capable jerky channel in `src/game/systems/soundSystem.js` (`startEatJerkyLoop` / `stopEatJerkyLoop`).
  - `healthConsumableSystem` now starts jerky loop on consume begin and stops it on cancel, completion, reset, and global `sound.stopAll()` paths.
  - Removed one-shot jerky playback at consume completion so audio now matches active eating window.
- Added Wireman footsteps with distance attenuation:
  - Pulled Freesound clip `810709` (Artninja, CC BY 4.0) and extracted a single step to `assets/audio/sfx/wireman_footstep_freesound_810709.mp3`.
  - Added `playWiremanFootstep({distance,maxDistance,sprint})` in `src/game/systems/soundSystem.js` with quadratic distance falloff and ~20-unit audible range cutoff.
  - Integrated movement-distance step cadence in `src/game/app.js` using `wireman.getState()` movement/position (`wiremanState.moving`, `wiremanState.sprinting`) with separate walk/sprint stride distances.
  - Updated `assets/audio/CREDITS.md` with Wireman source attribution/license and clarified mixed CC0/CC BY licensing notes.
- Reworked Wireman `810709` audio usage per follow-up request:
  - Removed Wireman movement footstep triggering from `app.js`.
  - Repurposed the clip as a dedicated attack SFX (`playWiremanAttackSound`) in `soundSystem`.
  - Wired `playWiremanAttackSound` into `wiremanSystem` and trigger it once in `startAttackCommit()` so it plays right as attack animation begins.
  - Renamed local asset to `assets/audio/sfx/wireman_attack_freesound_810709.mp3` and updated credits entry heading/path.
- Updated Wireman attack SFX to reuse the player's footstep clip and pitch it down slightly:
  - `wiremanAttack` pool now uses `assets/audio/sfx/footsteps_freesound_706207.mp3`.
  - `playWiremanAttackSound` playback tuned to `playbackRate: 0.9` with light jitter for a subtle lower pitch.
  - Credits updated to reflect the reused source instead of separate Wireman-specific source attribution.
- Audio mapping corrected per latest request:
  - Wireman attack now uses `assets/audio/sfx/wireman_attack_freesound_810709.mp3` again.
  - Wireman movement footsteps restored and now reuse the player's `footsteps_freesound_706207.mp3` with distance attenuation and walk/sprint cadence.
  - Credits updated to reflect separate Wireman attack source (810709) plus reused footstep source for Wireman movement.
- Trimmed `assets/audio/sfx/melee_hit_wall.wav` to a single wall-impact transient (removed extra peaks/tails).
  - New duration: `0.09s`.
  - Verified a single dominant peak remains in signal analysis.
- Reworked `melee_hit_wall.wav` again to avoid premature cutoff:
  - Re-pulled the original BigSoundBank `0401.wav` source and re-extracted a single isolated strike with a longer decay tail.
  - New wall-hit clip duration: `0.24s` (up from `0.09s`).
  - Verified one dominant peak remains in analysis (single-hit behavior preserved).
- Updated knife-on-wireman melee hit SFX to Freesound `413496`:
  - Added `assets/audio/sfx/knife_hit_wireman_freesound_413496.mp3` from InspectorJ (CC BY 4.0).
  - Added `playKnifeHitWireman()` in `soundSystem` and wired it through `app.js` into `meleeSystem`.
  - `meleeSystem` now plays knife-specific wireman-hit SFX when `selectedItem.id === "knife_01"`; bat/default wireman-hit uses the existing `melee_hit_wireman.wav`.
  - Updated `assets/audio/CREDITS.md` with attribution/license/source URL for `413496` and clarified bat/default wireman hit entry.
- Adjusted player footstep cadence under soda speed boost:
  - In `src/game/app.js`, player footstep stride distance now scales by `health.getPlayerSpeedMultiplier()`.
  - Result: when soda increases movement speed, required distance per step increases proportionally, keeping footstep frequency stable instead of accelerating.
- Wired background music loop from `assets/audio/bgm.mp3`:
  - Added looped BGM channel in `src/game/systems/soundSystem.js` with `startBgmLoop` / `stopBgmLoop` APIs.
  - `activateGameplay()` now calls `sound.startBgmLoop()` after user gesture unlock.
  - BGM participates in existing `sound.stopAll()` flow (stops on game over/win/regenerate and restarts when gameplay is activated again).
- Reduced BGM playback loudness by 50%:
  - `startBgmLoop()` now starts with `volumeScale: 0.5` in `src/game/systems/soundSystem.js`.
- Added sprint FOV response with smoothing:
  - New constants in `src/game/constants.js`: `PLAYER_SPRINT_FOV_BOOST_DEGREES` (`4`) and `PLAYER_SPRINT_FOV_EMA_HALF_LIFE_SECONDS` (`0.09`).
  - `src/game/systems/playerViewSystem.js` now tracks base camera FOV, computes a sprint target FOV, EMA-blends camera FOV toward it every frame, and updates projection only when the value changes.
  - `resetPose()` now restores camera FOV to base immediately.
- Added heartbeat SFX synced to HUD pulse timing:
  - Imported Freesound clip `418788` to `assets/audio/sfx/heartbeat_freesound_418788.mp3`.
  - Added `playHeartbeat` to `src/game/systems/soundSystem.js`.
  - `src/game/systems/healthConsumableSystem.js` now detects primary/secondary heartbeat pulse crossings from the same phase used by heart visual scaling and triggers `playHeartbeatSound` on each beat.
  - Wired callback in `src/game/app.js` (`playHeartbeatSound: sound.playHeartbeat`).
  - Updated attribution in `assets/audio/CREDITS.md`.
- Reduced heartbeat SFX loudness to ~50% in `src/game/systems/soundSystem.js` by lowering `playHeartbeat` volume scale (`0.5` normal / `0.55` low-stamina boost).
- Locked player locomotion during consumable use (jerky, first aid kit, soda):
  - In `src/game/app.js`, update loop now processes consumable-use state before movement and swaps to an immobilized key-state when `health.getState().jerkyConsumeActive` is true.
  - Effect: no movement/sprint/jump translation, no sprint stamina drain, and no player footsteps while consuming.
- Revamped start/game-over/victory overlay presentation for a stronger analog-horror tone:
  - Updated `index.html` overlay visuals with mode-aware styling (`data-mode=start|death|win`), scanline/vignette treatment, revised panel/button styles, and clearer grouped controls.
  - Renamed title screen and document title to **Wirehouse**.
  - Updated `setOverlayMode` in `src/game/app.js` to set `dom.overlay.dataset.mode`, refreshed start/death/win copy, and changed start button label to `Enter Wirehouse`.
- Start/title overlay copy cleanup:
  - Removed debug-controls line from the title screen controls list.
  - Removed the `Analog Horror Survival Maze` tagline and its related CSS selectors.
- Hid status text HUD (`#status`) by setting `display: none` in `index.html` so top-left status messages are no longer shown.
- Inventory HUD/input polish:
  - Removed `#inventory-count` markup so the wheel center now shows only `Inventory`.
  - Added inventory wheel rotation lockout tied to animation duration in `src/game/systems/inventorySystem.js`.
  - `rotateInventoryWheel` now returns `false` while a rotate animation is still in progress, preventing repeated Left/Right key rotates until the current move completes.
- Inventory rotation queueing:
  - `rotateInventoryWheel` now enqueues requested pivot steps instead of dropping inputs while an animation is active.
  - Added `consumeQueuedInventoryRotation` + `update()` in `src/game/systems/inventorySystem.js` to process one queued pivot each time the previous 160ms move animation completes.
  - `app.js` now calls `inventory.update()` each frame so queued pivots execute automatically.
  - Added `event.repeat` guard for Left/Right arrows so key-hold repeat does not flood the queue; discrete key presses queue as intended.
- Added gradual result-screen fade-in (game over + victory):
  - New overlay animation class in `index.html`: `#overlay.result-fade-in` with keyframes `overlay-result-fade-in`.
  - `src/game/app.js` now uses `showOverlay({ fadeIn: true })` for `triggerGameOver()` and `triggerWin()`.
  - Default fade duration set by `RESULT_OVERLAY_FADE_DURATION_SECONDS = 3`.
  - Normal pause/start overlay show/hide uses helper methods without fade.
- Added a global debug-key switch in `src/game/app.js`:
  - `DEBUG_KEY_ENABLED = true`
  - `DEBUG_KEY_CODES` set gates all debug hotkeys (H, /, O, N, I, U, B, P, T) in `onKeyDown`.
- Added found-footage grain/static post effect:
  - Added grain tuning constants in `src/game/constants.js`: `FOUND_FOOTAGE_GRAIN_INTENSITY` and `FOUND_FOOTAGE_GRAIN_STATIC_STRENGTH`.
  - Added a custom full-screen `ShaderPass` after SMAA in `src/game/setupRuntime.js` (animated grain + occasional static band noise).
  - Exposed pass as `runtime.foundFootageGrainPass` and update `time` uniform each frame from `app.js` to animate the effect.
- Replaced shader hash PRNG with CPU-generated noise texture for found-footage grain:
  - In `src/game/setupRuntime.js`, build a `THREE.DataTexture` from `Math.random()` values on startup.
  - Grain/static shader now samples `noiseTex` uniform instead of computing hash noise in the fragment shader.
- Updated found-footage grain PRNG approach per follow-up:
  - Removed CPU noise texture path.
  - Grain/static now generated fully in-shader using a higher-quality hash-without-sine PRNG (`prng(vec3)`), replacing the earlier weaker hash pattern.
- Added an explicit startup loading gate so gameplay cannot begin until initial assets are loaded:
  - Introduced a dedicated overlay loading line (`#overlay-loading`) plus disabled-button styling in `index.html`.
  - Added DOM reference wiring for `overlayLoading` in `src/game/domRefs.js`.
  - Added runtime asset-load progress tracking in `src/game/setupRuntime.js` via a shared `THREE.LoadingManager` used by both `TextureLoader` and `GLTFLoader`.
  - Exposed `waitForInitialAssetLoad()`, `getAssetLoadProgress()`, and `subscribeAssetLoadProgress()` from runtime.
  - Added preload hooks:
    - `preloadAllTemplates()` in `src/world/props.js`
    - `preloadAllTemplates()` in `src/world/pickups.js`
    - `preloadAllAssets()` in `src/game/systems/worldSystem.js`
  - Made maze regeneration awaitable:
    - `world.regenerateMaze()` now awaits async prop/pickup regeneration.
    - `regenerateMaze()` in `src/game/app.js` is now async and awaits world regeneration.
  - Startup flow now preloads assets + maze content before enabling start:
    - `initializeStartupAssets()` in `src/game/app.js` subscribes to load progress, updates overlay loading text, and only enables start once complete.
    - Start/resume activation paths now gate on `initialAssetsReady` and loading-in-progress state.
    - Added `flags.assetsReady` to `render_game_to_text` output (`src/game/renderGameToText.js`).
- Validation:
  - Skill client run: `output/loading-gate-client/shot-0.png`, `shot-1.png`, `shot-2.png`, `state-0.json`, `state-1.json`, `state-2.json`.
  - Verified transition from paused start overlay to playing state (`state-1.json`/`state-2.json` with `flags.assetsReady=true`, `flags.gameActive=true`).
  - No Playwright error artifact emitted for final run (`output/loading-gate-client/errors-*.json` absent).
  - Additional startup-gate probe (Playwright script) confirmed:
    - initial load period shows disabled start button + loading text/progress,
    - start button only becomes enabled after assets report ready.
- Added an in-overlay settings menu for mouse/audio control:
  - New settings panel in `index.html` with:
    - `Invert Mouse (Y-axis)` checkbox
    - `Music Volume` slider + live percent
    - `SFX Volume` slider + live percent
  - Added settings toggle button (`Settings` / `Close Settings`) alongside the start button.
  - Added styling for settings panel and secondary action button, preserving existing visual language.
- Added settings DOM hooks in `src/game/domRefs.js` for all new controls.
- Added persisted player settings in `src/game/app.js`:
  - Storage key: `wirehouse.settings.v1`
  - Defaults: invert mouse off, music 25%, sfx 100%
  - UI sync + persistence on change
  - Settings are loaded on boot and applied immediately.
- Implemented invert mouse (Y-axis) in `src/game/app.js`:
  - Added pointer-lock mousemove compensation that flips vertical look while preserving horizontal look direction.
  - Compensation runs only when controls are locked and invert setting is enabled.
- Implemented music/sfx volume controls in `src/game/systems/soundSystem.js`:
  - Added category volume state (`music`, `sfx`) and public `setVolumes()` / `getVolumes()` API.
  - Routed all SFX playback through `sfx` volume multiplier.
  - Routed BGM through `music` volume multiplier.
  - Added loop-time volume updates for active looping sounds so slider changes apply immediately.
- Added settings visibility in debug text state:
  - `render_game_to_text` now includes `flags.invertMouseY` and a `settings` payload with `invertMouseY`, `musicVolumePercent`, and `sfxVolumePercent`.

Validation:
- Skill client regression run:
  - `output/settings-menu-client/shot-0.png`, `shot-1.png`, `shot-2.png`
  - `output/settings-menu-client/state-0.json`, `state-1.json`, `state-2.json`
  - No error artifacts emitted (`errors-*.json` absent).
- Targeted settings verification:
  - `output/settings-menu-validation/settings-open.png` (menu visible)
  - `output/settings-menu-validation/settings-updated.png` (invert+slider changes reflected)
  - `output/settings-menu-validation/state-after-start.json` confirms gameplay started with updated settings values.
  - `output/settings-menu-validation/ui-state.json` confirms control values/labels.
- Persistence check via Playwright reload in same browser context:
  - Confirmed settings survive reload (`invert=true`, `music=60`, `sfx=45`).
- Formalized pause behavior (Escape + pause menu) in `src/game/app.js`:
  - Added explicit pause state (`isPaused`) separate from start/game-over/win.
  - Added new overlay mode `pause` in `setOverlayMode()`:
    - title: `Paused`
    - subtitle: `Game paused. Adjust settings or resume when ready.`
    - primary action: `Resume`
    - controls list hidden while paused.
  - Added `pauseGameplay()` helper that performs a full pause:
    - sets `gameActive=false`, `isPaused=true`, exits top-down view,
    - cancels active consumable use,
    - resets movement input,
    - stops all audio,
    - shows pause overlay and hides crosshair.
  - `Escape` key now explicitly pauses gameplay via `pauseGameplay()` (and closes settings if already paused/open).
  - Pointer unlock flow now maps to pause menu instead of the prior "pointer unlocked" hidden-overlay state.
  - Resume path (`activateGameplay`) now clears pause state and closes settings.
- Implemented pause freeze semantics:
  - `update()` now early-returns while paused, freezing simulation advancement.
  - Verified frozen state by sampling `render_game_to_text` twice ~1.4s apart while paused; player and wireman positions were unchanged.
- Extended text state for pause observability:
  - Added `flags.paused` to `render_game_to_text` output.

Validation:
- Skill client regression run after pause changes:
  - `output/pause-menu-client/shot-0.png`, `shot-1.png`, `shot-2.png`
  - `output/pause-menu-client/state-0.json`, `state-1.json`, `state-2.json`
  - No `errors-*.json` emitted.
- Targeted pause-menu flow validation:
  - `output/pause-menu-validation/pause-menu.png` (pause menu visible after Escape)
  - `output/pause-menu-validation/pause-menu-settings-open.png` (settings panel reachable from pause menu)
  - `output/pause-menu-validation/paused-snapshot.json` confirms:
    - `overlayMode="pause"`, `title="Paused"`, `startLabel="Resume"`,
    - game state `flags.paused=true` and `flags.gameActive=false` while paused.
  - `output/pause-menu-validation/state-resumed.json` confirms resume returns to `mode="playing"`, `flags.gameActive=true`, `flags.paused=false`.
  - Freeze check: `output/pause-menu-validation/pause-freeze-check.json` confirms no player/wireman movement while paused.
- Added a dedicated `Enable Debug Keys` setting toggle end-to-end in settings UI + persistence flow:
  - UI control: `#debug-keys-toggle` in `index.html`.
  - DOM ref wiring: `src/game/domRefs.js`.
  - Persisted setting: `enableDebugKeys` in `wirehouse.settings.v1` defaults/load/save in `src/game/app.js`.
  - Runtime gating: debug-only keybinds (`H`, `/`, `O`, `N`, `I`, `U`, `B`, `P`, `T`) now honor `playerSettings.enableDebugKeys`.
- Extended `render_game_to_text` in `src/game/renderGameToText.js` to expose debug setting state:
  - `flags.debugKeysEnabled`
  - `settings.debugKeysEnabled`
- Refactored Wireman AI from heuristic hunt/search scores to a belief-distribution model in `src/game/systems/wiremanSystem.js`:
  - Added normalized per-cell belief state (`p(player in cell)`) over walkable tiles.
  - LOS update now collapses belief to observed player cell (single-cell posterior).
  - No-LOS update now runs prediction + negative-evidence filtering:
    - Prediction propagates belief through walkable neighbor transitions using player-speed-derived multi-substep diffusion.
    - Visible cells without observed player are down-weighted by epsilon (`1e-3`) before renormalization.
  - Removed explicit search-scan state machine; non-LOS navigation now selects max info-gain viewpoints (belief mass visible from candidate tile, path-cost penalized).
  - Kept chase behavior under direct LOS and sprint/attack handling.
  - Kept minimap/debug hooks by reusing `getHuntScoreForCell`/`getHuntScoreMax`, now backed by belief probability (`0..1`).
- Added belief debug info to Wireman state:
  - `beliefPeakCell`, `beliefPeak` in `wireman.getState()`.
  - Mirrored into `render_game_to_text` under `wireman` payload.

Validation:
- Static module syntax check via esbuild bundling for `src/game/systems/wiremanSystem.js` completed successfully.
- Per user request, skipped Playwright runtime validation.
- Fixed `H` debug minimap visualization scaling for the new belief-based Wireman AI in `src/game/app.js`:
  - Heatmap normalization now uses current belief peak probability (`wiremanState.beliefPeak`) instead of the old fixed score range.
  - Header now shows `Pmax` percentage so posterior concentration is readable while debugging.
- Validation:
  - Performed static bundle check for `src/game/app.js` with externals for import-map modules (`three`, `three/*`, `n8ao`, `three-mesh-bvh`); build succeeded.
- Updated `H` wireman debug minimap probability visualization to a logarithmic scale in `src/game/app.js`:
  - `getWiremanMinimapScoreColor` now applies log-domain normalization (with floor clamp) before color interpolation.
  - `renderWiremanMinimap` now computes live belief scale stats (`max`, `minPositive`) from current posterior grid and feeds them into color mapping.
  - Keeps `Pmax` header while making low-probability posterior structure visible.
- Validation:
  - Static `app.js` bundle check via esbuild with import-map externals succeeded.
